---
title: "Part Two"
author: "PUT YOUR GROUP NAMES HERE"
date: "2/14/2022"
output:
  pdf_document:
    toc: true
    number_sections: true
    toc_depth: 3
---
test change

\newpage
\setcounter{page}{1}

```{r load packages and set options, include=FALSE}
install.packages('patchwork')
install.packages('moments')
library(tidyverse) 
library(magrittr)
library(knitr)
library(patchwork)
library(moments)

theme_set(theme_bw())

options(tinytex.verbose = TRUE)
knitr::opts_chunk$set(echo=FALSE, message=FALSE)

```

```{r load data}
anes_timeseries <- read.csv("datasets/anes_timeseries_2020_csv_20220210.csv")
nrow_original <- nrow(anes_timeseries)
head(anes_timeseries)
```


```{r consolidate data}
# selecting interesting columns to study
anes_data <- anes_timeseries[, c('V200001', 'V201018', 'V201024', 
                                 'V202120a', 'V202119', 'V201228', 
                                 'V201229', 'V201230', 'V202123', 
                                 'V202066', 'V202051')]

# Rename the columns
anes_data <- anes_data %>%
  rename(case_id = V200001) %>%
  rename(registed_party = V201018) %>%
  rename(manner_of_vote = V201024) %>%
  rename(difficulty_registering = V202120a) %>%
  rename(difficult_to_vote = V202119) %>%
  rename(party_identification = V201228) %>%
  rename(strong_party_identification = V201229) %>%
  rename(leaning_party_identification = V201230) %>%
  rename(reason_why_did_not_vote = V202123) %>%
  rename(voted = V202066) %>%
  rename(registered_to_vote = V202051)

# Rename the columns
anes_data
```
```{r assign NAN to dataset}
# any datapoint that are in the negative either has no answer of is experiencing technical difficulties. 
# For that We should change that to NAN

for (i in colnames(anes_data)){
   anes_data[i][anes_data[i] < 0] <- NA
}

```

```{r voter ins 2020 elections}
# Voters classification. 
# 1. Difficulty in Registering for Vote (1)
# 2. Registered to Vote at current address (1) at different address (2) not registered (3)
# 2. Voted NO: (1-3) YES:(4)

compute_eligible_voters <- function() {
  # create several truth statements here
  hasVoted <- (anes_data$voted==4)
  hasNotRegistered <- (anes_data$registered_to_vote==3)
  hasDifficultRegistered <- (anes_data$difficulty_registering==1)
  
  testCase <- (hasVoted) | (hasNotRegistered & hasDifficultRegistered)
  return(testCase)
}

anes_data$isVoter <- compute_eligible_voters()
```



```{r grouping of republican and democrats}
# assignment of republican and democrats
# Here partitians are considered as those who identified themselves as strong, weak and leaning toward that party
## for republicans: (party_identification) V201228 = 2, (strong_party_identification) V201229 = 1,2 (leaning) V201230 = 1
## for democrats: (party_identification) V201228 = 1, (strong_party_identification)V201229 = 1,2 (leaning)  V201230 = 3

assign_party <- function(R=T){
  if(R) {
    isRep <- (anes_data$party_identification == 2)
    isOther <- ((anes_data$party_identification == 3) | (anes_data$party_identification == 5))
    isStrong <- (anes_data$strong_party_identification == 1)
    isWeak <- (anes_data$strong_party_identification == 2)
    isRepLeaning <- (anes_data$leaning_party_identification == 1)

    testCase <- ((isRep & isStrong) | (isRep & isWeak) | (isOther &  isRepLeaning))
    return (testCase)
  }
  else {
    isDem <- (anes_data$party_identification == 1)
    isOther <- ((anes_data$party_identification == 3) | (anes_data$party_identification == 5))
    isStrong <- (anes_data$strong_party_identification == 1)
    isWeak <- (anes_data$strong_party_identification == 2)
    isDemLeaning <- (anes_data$leaning_party_identification == 3)
    testCase <- ((isDem & isStrong) | (isDem & isWeak) | (isOther &  isDemLeaning))
    return (testCase)
  }
}

anes_data$isRepublicans <- assign_party()
anes_data$isDemocrats <- assign_party(R=F)

```

```{r make summary table} 
summary_table <- anes_data %>% 
  mutate(
    percentage_voters = case_when(
      isVoter ~ 'Eligible Voters',
      !isVoter ~ 'Others',
    ),
    percentage_partisan = case_when(
      isRepublicans ~ 'Republicans',
      isDemocrats ~ 'Democrats', 
      ((!isRepublicans) & (!isDemocrats)) ~ 'Indepedents')) %$% 
  prop.table(
    table(percentage_voters,
          percentage_partisan))

summary_table
```


```{r summary-table}
kable(
  summary_table,
  digits = 2,
  caption = 'Percentage of Voter by Partisan in 2020', 
  booktabs = TRUE, 
)
```

